# Валидация фидов

gRPC сервер для проверка номеров и валидации структуры фидов

## Реализованные методы

* CheckPhonesAll - Проверка номеров во всех заданных фидах
* CheckPhonesRealty - Проверка номеров в фидах Яндекс Недвижимости
* CheckPhonesCian - Проверка номеров в фидах Циан
* CheckPhonesAvito - Проверка номеров в фидах Авито
* CheckPhonesDomclick - Проверка номеров в фидах Домклик
* ValidateFeed - Валидация структуры фида
* ValidateFeedAll - Валидация структуры всех заданных фидов

Более подробно ознакомиться с протоколами можно в файле `api/grpc/feed-service.proto`

## Makefile

`gen_go` - Конверт-ия proto файлов в код Go на основании `api/grpc/feed-service.proto`

```bash
make gen_go
```

`gen_python` - Конверт-ия proto файлов в исходный код Python на основании `api/grpc/feed-service.proto`

```bash
make gen_python
```

`build` - Компиляция серверного приложения в файл `./bin/server_app`

```bash
make build
```

## Опции

`-f`: Выбор конфигурационного файла.

`--env`: Использование в качестве конфигурации переменных окружения.

`--trace`: Сделать уровень логирования по умолчанию равным "Trace". Так же добавит: pid процесса, функция вызова

## Конфигурация (Сервер)

На выбор несколько вариантов настройки:

* По умолчанию в качестве настроек используется config.yml в папке с исполняемым файлом
* С помощью флага `-f` укажите путь на конфигурационный файл
* С помощью флага `--env` в качестве настроек используются переменные окружения

### Файл конфигурации

По умолчанию для настроек используется config.yml в папке с исполняемым файлом.  
Для использования альтернативного файла используйте флаг `-f`

```yaml
# Пример конфигурационного файла
keys_dir: /path/to/keys   // Путь к папке с сервисными ключами

google_sheets:
  service_key: 'file.json' // Сервисный ключ для доступа GoogleSheets Api

grpc:
  ip: "0.0.0.0"           // Host
  port: 50051             // Порт который будет прослушивать сервис

tg:
  token: 'TG Token'       // Токен для telegram бота
  chat: 0000000000        // ID чата в который будут отправляться уведомления
  is_enabled: false       // Статус уведомлений
```

### Использование переменных окружения

Для использования переменных окружения используйте флаг  `--env`

| Переменная        | Описание                                         |
|-------------------|--------------------------------------------------|
| `GRPC_IP`         | Host                                             |
| `GRPC_PORT`       | Порт, который будет прослушивать сервис          | 
| `TG_TOKEN`        | Токен для telegram бота                          |
| `TG_CHAT`         | ID чата в который будут отправляться уведомления |
| `TG_ENABLED`      | Статус уведомлений                               |
| `KEYS_DIR `       | Путь к папке с сервисными ключами                |
| `GS_SERVICE_KEY ` | Сервисный ключ для доступа GoogleSheets Api      |
